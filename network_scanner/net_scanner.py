#!usr/bin/env python3.8
import scapy.all as scapy
import argparse


def arguments():
    args = argparse.ArgumentParser()
    args.add_argument("-t", "--target", dest="target", help="Target IP / IP Range")
    inputs = args.parse_args()
    return inputs


def scan(ip):
    arp_req = scapy.ARP(pdst=ip)
    print(arp_req.summary())
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    arb = broadcast/arp_req
    answered = scapy.srp(arb, timeout=1, verbose="false")[0]

    final_list = []

    for answer in answered:
        ip_mac_dict = {"ip": answer[1].psrc, "mac": answer[1].hwsrc}
        final_list.append(ip_mac_dict)

    return final_list


def print_result(results):
    print("__________________________________________")
    print(" ip" + "\t\t | \t\t" + "mac")
    print("------------------------------------------")
    for result in results:
        print(result["ip"] + "\t\t " + result["mac"])

    print("__________________________________________")

# varip = '192.168.0.1/24'
inp = arguments()
scan_result = scan(inp.target)
print_result(scan_result)
